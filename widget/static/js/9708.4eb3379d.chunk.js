"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[9708],{62910:(e,t,i)=>{i.r(t),i.d(t,{Loader:()=>x,default:()=>b});var a=i(9950),s=i(96011),o=i.n(s),l=i(906),r=(i(92043),i(36907)),d=i(93807),n=i(66345),p=n.HY?"cloud.tagshop.ai":"cloud.tagbox.com";const h=class{constructor(e,t,i){var a="media/tmpimages/",s=p;n.Qy&&(a="ugc-suite/tmp/",s="cloud.tagbox.com"),n.HY&&(a="tmp/"),this.uppy=new r.A({meta:{type:"avatar"},autoProceed:!0,debug:!0,allowMultipleUploads:!0,restrictions:{maxFileSize:104857600,maxNumberOfFiles:i||1,minNumberOfFiles:1,allowedFileTypes:["image/*","video/*"]},onBeforeFileAdded:e,onBeforeUpload:t}),this.uppy.use(d.Ay,{params:{auth:{key:"0701d3d7f8d94e92a65a9cba388b1d96"},steps:{store:{robot:"/wasabi/store",bucket_region:"us-west-1",result:!0,bucket:s,key:"47ABVORKG52UYE1KB28S",secret:"pcaTfeokaz28geAAns08H3yaGbOVz6ILgTptu19v",path:a+"${file.id}.${file.ext}"}}},waitForEncoding:!0})}};var c=i(76506),u=i(80415),m=i(41397),f=i.n(m),g=i(44414),x=e=>{var{value:t,isBar:i}=e,a=Math.round((100-t)/100*182.12);return i?(0,g.jsx)("div",{className:"t_m_pb_wrap",children:(0,g.jsx)("div",{className:"t_m_pb",style:{width:"".concat(t,"%")},children:(0,g.jsx)("div",{})})}):(0,g.jsx)("div",{className:"t_m_propgress",children:(0,g.jsxs)("svg",{width:"78",height:"78",viewBox:"-10 -10 100 100",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{transform:"rotate(-90deg)"},children:[(0,g.jsx)("circle",{r:"30",cx:"40",cy:"40",fill:"transparent",stroke:"#D9D9D9",strokeWidth:"4",strokeDasharray:"188.4px",strokeDashoffset:"0"}),(0,g.jsx)("circle",{id:"path_fr_circle",r:"30",cx:"40",cy:"40",stroke:"#545454",strokeWidth:"4",strokeLinecap:"butt",strokeDashoffset:"".concat(a,"px"),fill:"transparent",strokeDasharray:"188.4px"}),(0,g.jsxs)("text",{x:"25px",y:"47px",fill:"#545454",fontSize:"14px",style:{transform:"rotate(90deg) translate(17px, -84px)"},textAnchor:"middle",dominantBaseline:"middle",children:[t,"%"]})]})})},y=[],v=[];class S extends a.Component{constructor(){super(...arguments),this.state={isLoading:!1,selectedFile:null,selectedUrl:null,type:null,thumb_file:[],fileSize:!1,filemaxSize:0,throwError:!1,videoPath:"",fileSizeText:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0,uploadPercent:100,limit:20,uploadedFiles:[]},this.beforeFileAdded=(e,t)=>{if((this.props.checkUpload(!0),v.length>0)&&v.find(t=>t.id==e.id))return!1;(0,c.Uy)(1);var{size:i,sizeText:a}=(0,c.Cq)(e.size),s=e.meta.type.includes("image")?4:5;if(["GB","TB"].includes(a))this.setState({type:s,fileSize:!0,fileSizeText:"".concat(i).concat(a)},()=>{this.onLoadError(s),setTimeout(()=>this.setState({fileSize:!1,fileSizeText:""}),2e3)}),(0,c.Uy)(2);else if("MB"==a){var o=4==s?15:100;if(i>=o)return this.setState({type:s,filemaxSize:o,fileSize:!0,fileSizeText:"".concat(i).concat(a)},()=>{this.onLoadError(s),setTimeout(()=>this.setState({fileSize:!1,fileSizeText:"",type:null},()=>this.onLoadError(s)),5e3)}),(0,c.Uy)(2),!1;5==s?v.length<20&&(y.push(e),v.push(e)):v.length<20&&v.push(e)}else"KB"==a&&v.length<20&&(e.meta.type.includes("video")&&y.push(e),v.push(e))},this.beforeUpload=e=>{for(var t of v)if(t.meta.type.includes("video")){this.videoProcess();break}return this.setState({isLoading:!0}),Object.fromEntries(Object.entries(e).filter(e=>{var[t,i]=e;return!i.meta.type.includes("video")}))},this.videoProcess=()=>{if(y.length>0&&v.length<=20)try{var{onsite_token:e,checkUpload:t}=this.props;this.setState({isLoading:!0});var i=y[0],a=new FormData;a.append("file",i.data),a.append("onsite_token",e);var s={headers:{productdomain:"taggbox.com"},onUploadProgress:e=>{var t=Math.round(100*e.loaded/e.total);this.setState({uploadPercent:t,isLoading:!0})}};o().post(n.Pt,a,s).then(e=>{var{responseData:a}=e.data;a&&a.length>0&&(this.setState(e=>({videoPath:a[0].sscode,isLoading:!1,type:5,selectedFile:a[0].s3Url,selectedUrl:a[0].s3Url,thumb_file:a[0].s3ThumbUrl,ext:i.extension,size:i.size,fileName:i.name,mediaHeight:a[0].height,mediaWidth:a[0].width,uploadedFiles:[...e.uploadedFiles,{name:i.name,url:a[0].s3Url,id:i.id}]}),()=>{this.onUpdateLocalState(),y.shift(),this.videoProcess()}),(0,c.Uy)(2),t(!1))}).catch(e=>{v=v.filter(e=>e.id!=i.id),this.setState({isLoading:!1,throwError:!0},()=>setTimeout(()=>this.setState({throwError:!1}),2e3)),(0,c.Uy)(2),t(!1)})}catch(l){this.videoProcess(),this.setState({isLoading:!1,throwError:!0},()=>setTimeout(()=>this.setState({throwError:!1}),2e3)),this.uppyUploader.uppy.cancelAll(),(0,c.Uy)(2),this.props.checkUpload(!1)}},this.uppyUploader=new h(this.beforeFileAdded,this.beforeUpload,this.state.limit),this.onRemovedState=e=>{var{type:t}=this.state;this.setState({selectedFile:null,selectedUrl:null,type:null,thumb_file:"",fileSize:!1,fileSizeText:"",videoPath:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0},()=>{this.onLoadError(t),e&&this.uppyUploader.uppy.cancelAll()})},this.onUpdateLocalState=()=>{var{addPostImage:e,isActiveIndex:t}=this.props,{selectedUrl:i,type:a,thumb_file:s,videoPath:o,ext:l,size:r,fileName:d,mediaHeight:n,mediaWidth:p,uploadedFiles:h}=this.state;e(i,5===a?s:i,a,n,p,o,t,l,r,d),5===a&&this.onRemovedState(!1)},this.onLoadError=e=>{var{uploadErrorCallback:t}=this.props,{fileSize:i,fileSizeText:a,filemaxSize:s,throwError:o}=this.state,l=i?"File Size (".concat(a,") Limit Exceeded ").concat(4==e?"Image":"Video"," Size : Max ").concat(s," MB"):"",r=o?"Something went wrong , Please try again.":"";t(l||(r||""))}}componentDidMount(){this.uppyUploader.uppy.on("transloadit:result",(e,t)=>{this.setState({isLoading:!1});var i=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.width:t.meta.height,a=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.height:t.meta.width,s="".concat(u.vr,"media/tmpimages/");n.Qy&&(s="https://cloud.tagbox.com/ugc-suite/tmp/"),n.HY&&(s="https://cloud.tagshop.ai/tmp/"),this.setState(e=>({type:t.mime.includes("video")?5:4,selectedFile:t.id,selectedUrl:"".concat(s).concat(t.id,".").concat(t.ext),ext:t.ext,size:t.size,fileName:t.name,mediaHeight:i,mediaWidth:a,uploadedFiles:[...e.uploadedFiles,{name:t.name,url:"".concat(s).concat(t.id,".").concat(t.ext),id:t.localId}]}),()=>this.onUpdateLocalState()),(0,c.Uy)(2)}),this.uppyUploader.uppy.on("file-removed",(e,t)=>{(0,c.Uy)(2)}),this.uppyUploader.uppy.on("upload-progress",(e,t)=>{this.setState({uploadPercent:(t.bytesUploaded/t.bytesTotal*100).toFixed()})}),this.uppyUploader.uppy.on("upload-error",(e,t)=>{this.setState({throwError:!0})}),this.uppyUploader.uppy.on("upload-complete",(e,t)=>{this.onRemovedState(!0)})}componentDidUpdate(e){var{removedFile:t}=this.props,{uploadedFiles:i}=this.state;if(!f().isEqual(t,e.removedFile)&&v.length>0){var a=i.find(e=>e.url==t.file);if(a&&Object.keys(a).length>0){5!=t.type&&this.uppyUploader.uppy.cancelAll();var s=v.find(e=>e.id==a.id);s&&(v=v.filter(e=>e.id!==s.id)),this.setState(e=>({uploadedFiles:e.uploadedFiles.filter(e=>e.url!==t.file)}))}}}render(){var e,t,{isLoading:i,fileSize:a,throwError:s,fileSizeText:o,filemaxSize:r,type:d,uploadPercent:n,limit:p}=this.state,{upload_image:h,formLanguage:c}=this.props;return h&&h.length<20?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)("div",{className:"t_m_upload ".concat(h&&h.length<1?"t_m_dd":""),children:(0,g.jsx)("div",{className:"t_m_up_wrp",children:h&&h.length<1?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(l.OX,{note:null!==(e=null===c||void 0===c?void 0:c.Video_size)&&void 0!==e?e:"Video Size : Max 100MB | Photo Size : Max 15MB | Max 20 Posts",uppy:this.uppyUploader.uppy,inline:!0,maxNumberOfFiles:p,width:"100%",height:"auto",locale:{strings:{dropHereOr:null!==(t=null===c||void 0===c?void 0:c.Drag_video)&&void 0!==t?t:"Drag a video / image to upload (optional)",browse:"browse"}}}),i?(0,g.jsx)(x,{value:n,isBar:!0}):null]}):i?(0,g.jsx)(x,{value:n,isBar:!1}):(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(l.zp,{uppy:this.uppyUploader.uppy,allowMultipleFiles:!0,locale:{strings:{browse:"browse"}}})})})})}):null}}const b=S}}]);