var ApplicationEmbed = ApplicationEmbed || function (w, u) {
    var AppPath = "http://127.0.0.1:5501/embed.json";
    function randomID(length) {
        var result = '';
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() *
                charactersLength));
        }
        return result;
    }

    return {
        init: function () {

        const classList = [
            'taggbox-socialwall',
            'taggbox',
            'tagshop-socialwall',
            'tagembed-socialwall',
            'tagembed-widget'
        ];

        classList.forEach(className => {

        const container = document.getElementsByClassName(className);

            for (let i = 0; i < container.length; i++) {

                const el = container[i];

                if (!el.getAttribute("data-is-load")) {

                    const url = AppPath;
                    const rootID = `root_${randomID(5)}`;

                    el.setAttribute("data-render-id", rootID);
                    el.setAttribute("data-is-load", 0);
                    el.setAttribute("id", `co_${rootID}`);
                    

                    if (el.getAttribute("ugcSuite")) {
                        window.ugcSuite = true;
                    }

                    window.isTagShop = true;
                    fetch(url)
                        .then(response => response.json())
                        .then(json => {

                            const { css, script } = json;

                            const wrapper = document.createElement("div");
                            wrapper.setAttribute("id", rootID);

                            const parent = document.getElementById(`co_${rootID}`);

                            if (parent) {

                                parent.appendChild(wrapper);

                                // Prevent duplicate CSS load
                                if (!document.querySelector(`link[href="${css}"]`)) {
                                    const myCss = document.createElement("link");
                                    myCss.type = 'text/css';
                                    myCss.rel = 'stylesheet';
                                    myCss.href = css;
                                    document.head.appendChild(myCss);
                                }

                                // Prevent duplicate Script load
                                if (!document.querySelector(`script[src="${script}"]`)) {
                                    const myreact = document.createElement("script");
                                    myreact.src = script;
                                    document.body.appendChild(myreact);
                                }
                            }
                        });
                }
            }
        })
     }
    };
}(window, undefined);
ApplicationEmbed.init();
